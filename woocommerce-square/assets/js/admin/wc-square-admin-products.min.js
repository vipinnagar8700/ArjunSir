"use strict";jQuery(document).ready($=>{var typenow=window.typenow||"";var pagenow=window.pagenow||"";var __=wp.i18n.__;if("product"!==typenow){return}if(!wc_square_admin_products.is_product_sync_enabled){return}else if("product_page_product_importer"===pagenow){var importNotice="<div class=\"error\">"+"<p>"+__("Product syncing with square has been enabled. "+"If you are trying to update product inventory, you should do it in Square. "+"Your existing inventory data in WooCommerce will be overwritten with data from Square products.","woocommerce-square")+"</p>"+"</div>";$(".wc-progress-steps").after(importNotice)}if("edit-product"===pagenow){$("#the-list").on("click",".editinline",e=>{var $row=$(e.target).closest("tr");var postID=$row.find("th.check-column input").val();var data={action:"wc_square_get_quick_edit_product_details",security:wc_square_admin_products.get_quick_edit_product_details_nonce,product_id:$row.find("th.check-column input").val()};$.post(wc_square_admin_products.ajax_url,data,response=>{var $editRow=$("tr#edit-"+postID);var $squareSynced=$editRow.find("select.square-synced");var $errors=$editRow.find(".wc-square-sync-with-square-errors");if(!response.success&&response.data){if("missing_variation_sku"===response.data){$squareSynced.prop("checked",false);$squareSynced.prop("disabled",true);$errors.find(".missing_variation_sku").show();return}}var $sku=$editRow.find("input[name=_sku]");var $stockStatus=$editRow.find("select[name=_stock_status]");var $stockQty=$editRow.find("input[name=_stock]");var $manageStockLabel=$editRow.find(".manage_stock_field .manage_stock");var $manageStockInput=$editRow.find("input[name=_manage_stock]");var $manageStockDesc="<span class=\"description\"><a href=\""+wc_square_admin_products.settings_url+"\">"+wc_square_admin_products.i18n.synced_with_square+"</a></span>";var edit_url=response.data.edit_url;var i18n=response.data.i18n;var is_variable=response.data.is_variable;$squareSynced.val(response.data.is_synced_with_square);$sku.on("change keyup keypress",e=>{if(""===$(e.target).val()&&!is_variable){$squareSynced.val("no").trigger("change");$squareSynced.prop("disabled",true);$errors.find(".missing_sku").show()}else{$squareSynced.prop("disabled",false);$squareSynced.trigger("change");return $errors.find(".missing_sku").hide()}}).trigger("change");$squareSynced.on("change",e=>{if(!wc_square_admin_products.is_inventory_sync_enabled){return}if("no"===$(e.target).val()){$manageStockInput.off();$manageStockInput.add($stockQty).css({opacity:1});$manageStockLabel.find(".description").remove();if(is_variable){if($manageStockInput.is(":checked")){$(".stock_qty_field").show();$(".backorder_field").show()}else{$(".stock_status_field").show()}}else{$stockQty.prop("readonly",false);$stockStatus.prop("readonly",false)}}else{$manageStockInput.on("click",()=>{return false});$manageStockInput.add($stockQty).css({opacity:"0.5"});$manageStockLabel.append($manageStockDesc);if(wc_square_admin_products.is_woocommerce_sor&&edit_url&&i18n){$manageStockLabel.append("<p class=\"description\"><a href=\""+edit_url+"\">"+i18n+"</a></p>")}if(is_variable){$(".stock_status_field").hide();$(".stock_qty_field").hide();$(".backorder_field").hide()}else{$stockQty.prop("readonly",true);$stockStatus.prop("readonly",true)}}}).trigger("change")})})}if("product"===pagenow){var syncCheckboxID="#_"+wc_square_admin_products.synced_with_square_taxonomy;var isVariable=()=>{return wc_square_admin_products.variable_product_types.includes($("#product-type").val())};var hasSKU=()=>{return""!==$("#_sku").val().trim()};var hasVariableSKUs=skus=>{if(!skus.length){return false}var valid=skus.filter(sku=>""!==$(sku).val().trim());return valid.length===skus.length};var hasUniqueSKUs=skus=>{var skuValues=skus.map(sku=>$(sku).val());return skuValues.every(sku=>skuValues.indexOf(sku)===skuValues.lastIndexOf(sku))};var hasMultipleAttributes=()=>{var $variation_attributes=$(".woocommerce_attribute_data input[name^=\"attribute_variation\"]:checked");return isVariable()&&$variation_attributes&&$variation_attributes.length>1};var showError=error=>{$(".wc-square-sync-with-square-error."+error).show();$(syncCheckboxID).prop("disabled",true);$(syncCheckboxID).prop("checked",false)};var hideError=function hideError(error){var enable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$(".wc-square-sync-with-square-error."+error).hide();if(enable){$(syncCheckboxID).prop("disabled",false)}};var handleSKU=syncCheckboxID=>{if(isVariable()){$("#_sku").off("change keypress keyup");hideError("missing_sku",!hasMultipleAttributes());var skus=$("input[id^=\"variable_sku\"]");skus.on("change keypress keyup",()=>{if(!hasVariableSKUs($.makeArray(skus))||!hasUniqueSKUs($.makeArray(skus))){showError("missing_variation_sku")}else{hideError("missing_variation_sku",!hasMultipleAttributes())}$(syncCheckboxID).triggerHandler("change")}).triggerHandler("change")}else{$("input[id^=\"variable_sku\"]").off("change keypress keyup");hideError("missing_variation_sku",!hasMultipleAttributes());$("#_sku").on("change keypress keyup",e=>{if(""===$(e.target).val().trim()){showError("missing_sku")}else{hideError("missing_sku",!hasMultipleAttributes())}$(syncCheckboxID).trigger("change")}).trigger("change")}};var handleAttributes=syncCheckboxID=>{$("#variable_product_options").on("reload",()=>{if(hasSKU()){$(syncCheckboxID).prop("disabled",false)}$(syncCheckboxID).trigger("change")}).trigger("reload")};var triggerUpdate=()=>{handleSKU(syncCheckboxID);$(syncCheckboxID).trigger("change");if(isVariable()&&!$("input[id^=\"variable_sku\"]").length){showError("missing_variation_sku")}};var toggleSyncProductMeta=productType=>{var syncProductMeta=$(".wc-square-sync-with-square");if(wc_square_admin_products.supported_products_for_sync.includes(productType)){syncProductMeta.show()}else{syncProductMeta.hide()}};handleAttributes(syncCheckboxID);var $stockFields=$(".stock_fields");var $stockInput=$stockFields.find("#_stock");var $stockStatus=$(".stock_status_field");var $manageField=$("._manage_stock_field");var $manageInput=$manageField.find("#_manage_stock");var $manageDesc=$manageField.find(".description");var manageDescOriginal=$manageDesc.text();var manageStockOriginal=$("#_manage_stock").is(":checked");$(syncCheckboxID).on("change",e=>{if(!wc_square_admin_products.is_inventory_sync_enabled){return}var variableProduct=wc_square_admin_products.variable_product_types.includes($("#product-type").val());var useSquare;if($(e.target).is(":checked")&&$("#_square_item_variation_id").length>0){useSquare=true;var syncInventory="";if(!$manageInput.is(":checked")&&!variableProduct){syncInventory=" (<a href=\"#\" class=\"sync-stock-from-square\" data-product-id=\""+$("#post_ID").val()+"\">"+wc_square_admin_products.i18n.sync_inventory+"</a>)<div class=\"sync-stock-spinner spinner\" style=\"float:none;\"></div>"}$manageDesc.html("<a href=\""+wc_square_admin_products.settings_url+"\">"+wc_square_admin_products.i18n.synced_with_square+"</a>"+syncInventory);$manageInput.on("click",()=>{return false});$manageInput.css({opacity:"0.5"});$stockInput.prop("readonly",true);if(wc_square_admin_products.is_woocommerce_sor&&!variableProduct){if($("p._stock_field span.description").length===0){$stockInput.after("<span class=\"description\" style=\"display:block;clear:both;\"><a href=\"#\" id=\"fetch-stock-with-square\">"+wc_square_admin_products.i18n.fetch_stock_with_square+"</a><div class=\"spinner\" style=\"float:none;\"></div></span>")}$("#fetch-stock-with-square").on("click",e=>{e.preventDefault();var $spinner=$("p._stock_field span.description .spinner");var data={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:$("#post_ID").val()};$spinner.css("visibility","visible");$.post(wc_square_admin_products.ajax_url,data,response=>{if(response&&response.success){var quantity=response.data.quantity;var manageStock=response.data.manage_stock;if(!manageStock){$manageInput.prop("checked",false).trigger("change");$("#_stock_status").val("instock");$manageDesc.html("<a href=\""+wc_square_admin_products.settings_url+"\">"+wc_square_admin_products.i18n.inventory_tracking_disabled+"</a>")}$stockInput.val(quantity);$stockFields.find("input[name=_original_stock]").val(quantity);$stockInput.prop("readonly",false);$("p._stock_field span.description").remove()}else{if(response.data){$(".inventory-fetch-error").remove();$spinner.after("<span class=\"inventory-fetch-error\" style=\"display:inline-block;color:red;\">"+response.data+"</span>")}$spinner.css("visibility","hidden")}})})}else if(wc_square_admin_products.is_square_sor){if($("p._stock_field span.description").length===0){$stockInput.after("<span class=\"description\" style=\"display:block;clear:both;\">"+wc_square_admin_products.i18n.managed_by_square+" (<a href=\"#\" class=\"sync-stock-from-square\" data-product-id=\""+$("#post_ID").val()+"\">"+wc_square_admin_products.i18n.sync_stock_from_square+"</a>)<div class=\"sync-stock-spinner spinner\" style=\"float:none;\"></div></span>")}}}else{useSquare=false;$("p._stock_field span.description").remove();$stockInput.prop("readonly",false);$manageDesc.html(manageDescOriginal);$manageInput.off("click");$manageInput.css({opacity:1});$manageInput.prop("checked",manageStockOriginal);if(!variableProduct){if(manageStockOriginal){$stockFields.show();$stockStatus.hide()}else{$stockStatus.show();$stockFields.hide()}}}$(".woocommerce_variation").each((index,e)=>{var variationID=$(e).find("h3 input.variable_post_id").val();var $variationManageInput=$(e).find(".variable_manage_stock");var $variationManageField=$variationManageInput.parent();var $variationStockInput=$(e).find(".wc_input_stock");var $variationStockField=$variationStockInput.parent();if(useSquare){$variationStockInput.prop("readonly",true);$variationManageInput.on("click",()=>{return false});$variationManageInput.css({opacity:"0.5"});if(0===$variationManageField.find(".description").length){var _syncInventory="";if(!$variationManageInput.is(":checked")){_syncInventory=" - <a href=\"#\" class=\"sync-stock-from-square\" data-product-id=\""+variationID+"\">"+wc_square_admin_products.i18n.sync_inventory+"</a><div class=\"sync-stock-spinner spinner\" style=\"float:none;\"></div>"}$variationManageInput.after("(<span class=\"description\">"+wc_square_admin_products.i18n.managed_by_square+"</span>)"+_syncInventory)}if(wc_square_admin_products.is_woocommerce_sor){var fetchVariationStockActionID="fetch-stock-with-square-"+variationID;if(0===$variationStockField.find("span.description").length){$variationStockInput.after("<span class=\"description\" style=\"display:block;clear:both;\"><a href=\"#\" id=\""+fetchVariationStockActionID+"\">"+wc_square_admin_products.i18n.fetch_stock_with_square+"</a><div class=\"spinner\" style=\"float:none;\"></div></span>")}$("#"+fetchVariationStockActionID).on("click",e=>{e.preventDefault();var $spinner=$(e.target).next(".spinner");var data={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:variationID};$spinner.css("visibility","visible");$.post(wc_square_admin_products.ajax_url,data,response=>{if(response&&response.success){var quantity=response.data.quantity;var manageStock=response.data.manage_stock;if(!manageStock){$variationManageInput.prop("checked",false).trigger("change")}$variationStockInput.val(quantity);$variationStockField.parent().find("input[name^=\"variable_original_stock\"]").val(quantity);$variationStockInput.prop("readonly",false);$variationStockField.find(".description").remove()}else{if(response.data){$(".inventory-fetch-error").remove();$spinner.after("<span class=\"inventory-fetch-error\" style=\"display:inline-block;color:red;\">"+response.data+"</span>")}$spinner.css("visibility","hidden")}})})}else if(wc_square_admin_products.is_square_sor){if($variationStockField.find("span.description").length===0){$variationStockInput.after("<span class=\"description\" style=\"display:block;clear:both;\"><a href=\"#\" class=\"sync-stock-from-square\" data-product-id=\""+variationID+"\">"+wc_square_admin_products.i18n.sync_stock_from_square+"</a><div class=\"sync-stock-spinner spinner\" style=\"float:none;\"></span>")}}}else{$variationStockInput.prop("readonly",false);$variationManageInput.off("click");$variationManageInput.css({opacity:1});$variationManageInput.next(".description").remove()}})}).trigger("change");$("#product-type").on("change",e=>{if("complete"===document.readyState){triggerUpdate()}toggleSyncProductMeta($(e.target).val())}).trigger("change");$("#product-type, #_square_gift_card").on("change",function(){var productType=$("#product-type").val();var squareGiftCardCheckbox=$("#_square_gift_card");var isGiftCard=squareGiftCardCheckbox.prop("checked");var displayToggleFields=[$(".wc-square-sync-with-square"),$(".inventory_sold_individually"),$("label[for=\"_virtual\"]"),$("label[for=\"_downloadable\"]"),$("._tax_status_field").closest(".options_group")];if("variable"===productType){displayToggleFields=[...displayToggleFields,$(".variable_is_virtual").closest(".tips"),$(".variable_is_downloadable").closest(".tips")]}if(isGiftCard){if(!$("#_virtual").prop("checked")){$("#_virtual").trigger("click").prop("checked",true)}$(".variable_is_virtual").each((index,virtualVariationEl)=>{if(!$(virtualVariationEl).prop("checked")){$(virtualVariationEl).trigger("click").prop("checked",true)}});displayToggleFields.forEach(object=>object.hide())}else{displayToggleFields.forEach(object=>object.show());if("variable"===productType){$("label[for=\"_virtual\"]").hide();$("label[for=\"_downloadable\"]").hide()}}}).trigger("change");var observer=null;observeVariations();$("#woocommerce-product-data").on("woocommerce_variations_loaded woocommerce_variations_added woocommerce_variations_removed",()=>{observeVariations();triggerUpdate()});function observeVariations(){var variationsContainer=document.querySelector(".woocommerce_variations");if(observer||!variationsContainer){return}observer=new MutationObserver(()=>{$("#_square_gift_card").trigger("change")});if(observer){observer.observe(variationsContainer,{attributes:false,childList:true,subtree:false})}}}});
